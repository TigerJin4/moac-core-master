
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Creating your own ERC721 Token on MOAC blockchain &#8212; moac-core-master  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Table of Contents" href="FAQs.html" />
    <link rel="prev" title="Creating your own ERC20 Token on the MOAC blockchain" href="ERC20.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="creating-your-own-erc721-token-on-moac-blockchain">
<h1>Creating your own ERC721 Token on MOAC blockchain<a class="headerlink" href="#creating-your-own-erc721-token-on-moac-blockchain" title="Permalink to this headline">¶</a></h1>
<p>Before you read this page, you should:</p>
<ul class="simple">
<li>Understand the following general concepts: blockchain, smart
contracts, ERC721 tokens;</li>
<li>Be able to write a basic Ethereum smart contract in Solidity (see
tutorial example);</li>
</ul>
<p>After you read this page, you will be able to:</p>
<ul class="simple">
<li>Write your own ERC721 token contract;</li>
<li>Compile and deploy it on the MOAC blockchain;</li>
<li>Use the ERC721 token;</li>
</ul>
</div>
<div class="section" id="write-the-erc721-token-smart-contract">
<h1>Write the ERC721 token smart contract<a class="headerlink" href="#write-the-erc721-token-smart-contract" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-721.md">ERC721
standard</a>
is developed by the Ethereum community. It is a standard interface for
non-fungible tokens(NFT), also known as deeds.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">contract</span> <span class="n">ERC721</span> <span class="p">{</span>
    <span class="n">function</span> <span class="n">balanceOf</span><span class="p">(</span><span class="n">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="n">external</span> <span class="n">view</span> <span class="n">returns</span> <span class="p">(</span><span class="n">uint256</span><span class="p">);</span>
    <span class="n">function</span> <span class="n">ownerOf</span><span class="p">(</span><span class="n">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> <span class="n">external</span> <span class="n">view</span> <span class="n">returns</span> <span class="p">(</span><span class="n">address</span><span class="p">);</span>
    <span class="n">function</span> <span class="n">safeTransferFrom</span><span class="p">(</span><span class="n">address</span> <span class="n">_from</span><span class="p">,</span> <span class="n">address</span> <span class="n">_to</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">_tokenId</span><span class="p">,</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">)</span> <span class="n">external</span> <span class="n">payable</span><span class="p">;</span>
    <span class="n">function</span> <span class="n">safeTransferFrom</span><span class="p">(</span><span class="n">address</span> <span class="n">_from</span><span class="p">,</span> <span class="n">address</span> <span class="n">_to</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> <span class="n">external</span> <span class="n">payable</span><span class="p">;</span>
    <span class="n">function</span> <span class="n">transferFrom</span><span class="p">(</span><span class="n">address</span> <span class="n">_from</span><span class="p">,</span> <span class="n">address</span> <span class="n">_to</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> <span class="n">external</span> <span class="n">payable</span><span class="p">;</span>
    <span class="n">function</span> <span class="n">approve</span><span class="p">(</span><span class="n">address</span> <span class="n">_approved</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> <span class="n">external</span> <span class="n">payable</span><span class="p">;</span>
    <span class="n">function</span> <span class="n">setApprovalForAll</span><span class="p">(</span><span class="n">address</span> <span class="n">_operator</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">_approved</span><span class="p">)</span> <span class="n">external</span><span class="p">;</span>
    <span class="n">function</span> <span class="n">getApproved</span><span class="p">(</span><span class="n">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> <span class="n">external</span> <span class="n">view</span> <span class="n">returns</span> <span class="p">(</span><span class="n">address</span><span class="p">);</span>
    <span class="n">function</span> <span class="n">isApprovedForAll</span><span class="p">(</span><span class="n">address</span> <span class="n">_owner</span><span class="p">,</span> <span class="n">address</span> <span class="n">_operator</span><span class="p">)</span> <span class="n">external</span> <span class="n">view</span> <span class="n">returns</span> <span class="p">(</span><span class="nb">bool</span><span class="p">);</span>
    <span class="n">function</span> <span class="n">supportsInterface</span><span class="p">(</span><span class="n">bytes4</span> <span class="n">interfaceID</span><span class="p">)</span> <span class="n">external</span> <span class="n">view</span> <span class="n">returns</span> <span class="p">(</span><span class="nb">bool</span><span class="p">);</span>
    <span class="n">event</span> <span class="n">Transfer</span><span class="p">(</span><span class="n">address</span> <span class="n">indexed</span> <span class="n">_from</span><span class="p">,</span> <span class="n">address</span> <span class="n">indexed</span> <span class="n">_to</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">_tokenId</span><span class="p">);</span>
    <span class="n">event</span> <span class="n">Approval</span><span class="p">(</span><span class="n">address</span> <span class="n">indexed</span> <span class="n">_owner</span><span class="p">,</span> <span class="n">address</span> <span class="n">indexed</span> <span class="n">_approved</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">_tokenId</span><span class="p">);</span>
    <span class="n">event</span> <span class="n">ApprovalForAll</span><span class="p">(</span><span class="n">address</span> <span class="n">indexed</span> <span class="n">_owner</span><span class="p">,</span> <span class="n">address</span> <span class="n">indexed</span> <span class="n">_operator</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">_approved</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>User can develop its own ERC721 token. For that, we can either use a
ready open source library to help with the task, or write the needed
smart contracts directly from scratch. We will show all three methods
below so you can master your ERC721 token development skills.</p>
<div class="section" id="using-a-ready-open-source-library">
<h2>Using a ready open source library<a class="headerlink" href="#using-a-ready-open-source-library" title="Permalink to this headline">¶</a></h2>
<p>Let’s see how you can implement this interface by taking advantage of
the OpenZeppelin Solidity library, for instance. We will write a
TestCoin based on, for example, the PausableToken contract in
OpenZeppelin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pragma solidity ^0.4.18;

import &quot;./ERC721Basic.sol&quot;;
import &quot;./ERC721Receiver.sol&quot;;
import &quot;../../math/SafeMath.sol&quot;;
import &quot;../../AddressUtils.sol&quot;;

contract ERC721BasicToken is ERC721Basic {
  using SafeMath for uint256;
  using AddressUtils for address;

  // Equals to `bytes4(keccak256(&quot;onERC721Received(address,uint256,bytes)&quot;))`
  // which can be also obtained as `ERC721Receiver(0).onERC721Received.selector`
  bytes4 constant ERC721_RECEIVED = 0xf0b9e5ba;

  // Mapping from token ID to owner
  mapping (uint256 =&gt; address) internal tokenOwner;

  // Mapping from token ID to approved address
  mapping (uint256 =&gt; address) internal tokenApprovals;

  // Mapping from owner to number of owned token
  mapping (address =&gt; uint256) internal ownedTokensCount;

  // Mapping from owner to operator approvals
  mapping (address =&gt; mapping (address =&gt; bool)) internal operatorApprovals;

  modifier onlyOwnerOf(uint256 _tokenId) {
    require(ownerOf(_tokenId) == msg.sender);
    _;
      }

modifier canTransfer(uint256 _tokenId) {
require(isApprovedOrOwner(msg.sender, _tokenId));
_;
}

function balanceOf(address _owner) public view returns (uint256) {
require(_owner != address(0));
return ownedTokensCount[_owner];
}

function ownerOf(uint256 _tokenId) public view returns (address) {
address owner = tokenOwner[_tokenId];
require(owner != address(0));
return owner;
}

function exists(uint256 _tokenId) public view returns (bool) {
address owner = tokenOwner[_tokenId];
return owner != address(0);
}

function approve(address _to, uint256 _tokenId) public {
address owner = ownerOf(_tokenId);
require(_to != owner);
require(msg.sender == owner || isApprovedForAll(owner, msg.sender));

if (getApproved(_tokenId) != address(0) || _to != address(0)) {
  tokenApprovals[_tokenId] = _to;
  emit Approval(owner, _to, _tokenId);
    }
}

function getApproved(uint256 _tokenId) public view returns (address) {
return tokenApprovals[_tokenId];
}

function setApprovalForAll(address _to, bool _approved) public {
require(_to != msg.sender);
operatorApprovals[msg.sender][_to] = _approved;
emit ApprovalForAll(msg.sender, _to, _approved);
}

function isApprovedForAll(
address _owner,
address _operator
)
public
view
returns (bool)
{
return operatorApprovals[_owner][_operator];
}

function transferFrom(
address _from,
address _to,
uint256 _tokenId
)
public
canTransfer(_tokenId)
{
require(_from != address(0));
require(_to != address(0));

clearApproval(_from, _tokenId);
removeTokenFrom(_from, _tokenId);
addTokenTo(_to, _tokenId);

    emit Transfer(_from, _to, _tokenId);
}

function safeTransferFrom(
address _from,
address _to,
uint256 _tokenId
)
public
canTransfer(_tokenId)
{
// solium-disable-next-line arg-overflow
safeTransferFrom(_from, _to, _tokenId, &quot;&quot;);
}

function safeTransferFrom(
address _from,
address _to,
uint256 _tokenId,
bytes _data
)
public
canTransfer(_tokenId)
{
transferFrom(_from, _to, _tokenId);
// solium-disable-next-line arg-overflow
require(checkAndCallSafeTransfer(_from, _to, _tokenId, _data));
}

function isApprovedOrOwner(
address _spender,
uint256 _tokenId
)
internal
view
returns (bool)
{
address owner = ownerOf(_tokenId);
// Disable solium check because of
// https://github.com/duaraghav8/Solium/issues/175
// solium-disable-next-line operator-whitespace
return (
  _spender == owner ||
  getApproved(_tokenId) == _spender ||
  isApprovedForAll(owner, _spender)
);
}

function _mint(address _to, uint256 _tokenId) internal {
require(_to != address(0));
addTokenTo(_to, _tokenId);
emit Transfer(address(0), _to, _tokenId);
}

function _burn(address _owner, uint256 _tokenId) internal {
clearApproval(_owner, _tokenId);
removeTokenFrom(_owner, _tokenId);
emit Transfer(_owner, address(0), _tokenId);
}

function clearApproval(address _owner, uint256 _tokenId) internal {
require(ownerOf(_tokenId) == _owner);
if (tokenApprovals[_tokenId] != address(0)) {
  tokenApprovals[_tokenId] = address(0);
  emit Approval(_owner, address(0), _tokenId);
}
}

function addTokenTo(address _to, uint256 _tokenId) internal {
require(tokenOwner[_tokenId] == address(0));
tokenOwner[_tokenId] = _to;
ownedTokensCount[_to] = ownedTokensCount[_to].add(1);
}

function removeTokenFrom(address _from, uint256 _tokenId) internal {
require(ownerOf(_tokenId) == _from);
ownedTokensCount[_from] = ownedTokensCount[_from].sub(1);
tokenOwner[_tokenId] = address(0);
}

function checkAndCallSafeTransfer(
address _from,
address _to,
uint256 _tokenId,
bytes _data
)
internal
returns (bool)
{
if (!_to.isContract()) {
  return true;
}
bytes4 retval = ERC721Receiver(_to).onERC721Received(
  _from, _tokenId, _data);
return (retval == ERC721_RECEIVED);
}
}
</pre></div>
</div>
<p>To understand better all the steps that the inheritance from
PausableToken has achieved in making our TestCoin a useful
ERC721-compliant token (and why it can be helpful to start from an open
source library like OpenZeppelin), you can follow closely the code of
each of the library’s files that were imported after each inheritance
and import is fully expanded.</p>
<p>For that, browsing the OpenZeppelin ERC721 token github repo will be
very helpful: our TestCoin is inheriting from PausableToken, which
itself inherits from StandardToken, which inherits from BasicToken and
ERC721, and so on all the way to ERC721Basic and the SafeMath library
import.</p>
</div>
<div class="section" id="developing-your-smart-contract-directly">
<h2>Developing your smart contract directly<a class="headerlink" href="#developing-your-smart-contract-directly" title="Permalink to this headline">¶</a></h2>
<p>Another way of doing this is to simply write the ERC721 interface and
your contract implementing it directly from scratch. As you’ll see, this
is actually a fairly straightforward task:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="o">.</span><span class="mi">16</span><span class="p">;</span>

<span class="n">contract</span> <span class="n">ERC721Token</span> <span class="p">{</span>
  <span class="n">uint256</span> <span class="n">public</span> <span class="n">totalSupply</span><span class="p">;</span>

  <span class="n">function</span> <span class="n">balanceOf</span><span class="p">(</span><span class="n">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="n">public</span> <span class="n">constant</span> <span class="n">returns</span> <span class="p">(</span><span class="n">uint256</span> <span class="n">balance</span><span class="p">);</span>
  <span class="n">function</span> <span class="n">transfer</span><span class="p">(</span><span class="n">address</span> <span class="n">_to</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">_value</span><span class="p">)</span> <span class="n">public</span> <span class="n">returns</span> <span class="p">(</span><span class="nb">bool</span> <span class="n">success</span><span class="p">);</span>
  <span class="n">function</span> <span class="n">transferFrom</span><span class="p">(</span><span class="n">address</span> <span class="n">_from</span><span class="p">,</span> <span class="n">address</span> <span class="n">_to</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">_value</span><span class="p">)</span> <span class="n">public</span> <span class="n">returns</span> <span class="p">(</span><span class="nb">bool</span> <span class="n">success</span><span class="p">);</span>

  <span class="n">function</span> <span class="n">approve</span><span class="p">(</span><span class="n">address</span> <span class="n">_spender</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">_value</span><span class="p">)</span> <span class="n">public</span> <span class="n">returns</span> <span class="p">(</span><span class="nb">bool</span> <span class="n">success</span><span class="p">);</span>

  <span class="n">function</span> <span class="n">allowance</span><span class="p">(</span><span class="n">address</span> <span class="n">_owner</span><span class="p">,</span> <span class="n">address</span> <span class="n">_spender</span><span class="p">)</span> <span class="n">public</span> <span class="n">constant</span> <span class="n">returns</span> <span class="p">(</span><span class="n">uint256</span> <span class="n">remaining</span><span class="p">);</span>

  <span class="n">event</span> <span class="n">Transfer</span><span class="p">(</span><span class="n">address</span> <span class="n">indexed</span> <span class="n">_from</span><span class="p">,</span> <span class="n">address</span> <span class="n">indexed</span> <span class="n">_to</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">_value</span><span class="p">);</span>
  <span class="n">event</span> <span class="n">Approval</span><span class="p">(</span><span class="n">address</span> <span class="n">indexed</span> <span class="n">_owner</span><span class="p">,</span> <span class="n">address</span> <span class="n">indexed</span> <span class="n">_spender</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">_value</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">contract</span> <span class="n">TestToken</span> <span class="ow">is</span> <span class="n">ERC721Token</span> <span class="p">{</span>

  <span class="n">string</span>  <span class="n">public</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Test Coin&quot;</span><span class="p">;</span>
  <span class="n">string</span>  <span class="n">public</span> <span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;TEST&quot;</span><span class="p">;</span>
  <span class="n">uint8</span>   <span class="n">public</span> <span class="n">decimals</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
  <span class="n">uint256</span> <span class="n">public</span> <span class="n">INITIAL_SUPPLY</span> <span class="o">=</span> <span class="mi">100000000</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">uint256</span><span class="p">(</span><span class="n">decimals</span><span class="p">));</span>

  <span class="n">mapping</span> <span class="p">(</span><span class="n">address</span> <span class="o">=&gt;</span> <span class="n">uint256</span><span class="p">)</span> <span class="n">balances</span><span class="p">;</span>
  <span class="n">mapping</span> <span class="p">(</span><span class="n">address</span> <span class="o">=&gt;</span> <span class="n">mapping</span> <span class="p">(</span><span class="n">address</span> <span class="o">=&gt;</span> <span class="n">uint256</span><span class="p">))</span> <span class="n">allowed</span><span class="p">;</span>

  <span class="n">function</span> <span class="n">TestToken</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">totalSupply</span> <span class="o">=</span> <span class="n">INITIAL_SUPPLY</span><span class="p">;</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">INITIAL_SUPPLY</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">function</span> <span class="n">transfer</span><span class="p">(</span><span class="n">address</span> <span class="n">_to</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">_value</span><span class="p">)</span> <span class="n">public</span> <span class="n">returns</span> <span class="p">(</span><span class="nb">bool</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">require</span><span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">_value</span> <span class="o">&amp;&amp;</span> <span class="n">balances</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">+</span> <span class="n">_value</span> <span class="o">&gt;</span> <span class="n">balances</span><span class="p">[</span><span class="n">_to</span><span class="p">]);</span>
    <span class="n">require</span><span class="p">(</span><span class="n">_to</span> <span class="o">!=</span> <span class="mh">0x0</span><span class="p">);</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_value</span><span class="p">;</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_value</span><span class="p">;</span>
    <span class="n">emit</span> <span class="n">Transfer</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_value</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">function</span> <span class="n">transferFrom</span><span class="p">(</span><span class="n">address</span> <span class="n">_from</span><span class="p">,</span> <span class="n">address</span> <span class="n">_to</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">_value</span><span class="p">)</span> <span class="n">public</span> <span class="n">returns</span> <span class="p">(</span><span class="nb">bool</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">require</span><span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="n">_from</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">_value</span> <span class="o">&amp;&amp;</span> <span class="n">allowed</span><span class="p">[</span><span class="n">_from</span><span class="p">][</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">_value</span><span class="p">);</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_value</span><span class="p">;</span>
    <span class="n">balances</span><span class="p">[</span><span class="n">_from</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_value</span><span class="p">;</span>
    <span class="n">allowed</span><span class="p">[</span><span class="n">_from</span><span class="p">][</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_value</span><span class="p">;</span>
    <span class="n">emit</span> <span class="n">Transfer</span><span class="p">(</span><span class="n">_from</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_value</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">function</span> <span class="n">balanceOf</span><span class="p">(</span><span class="n">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="n">public</span> <span class="n">constant</span> <span class="n">returns</span> <span class="p">(</span><span class="n">uint256</span> <span class="n">balance</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">balances</span><span class="p">[</span><span class="n">_owner</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="n">function</span> <span class="n">approve</span><span class="p">(</span><span class="n">address</span> <span class="n">_spender</span><span class="p">,</span> <span class="n">uint256</span> <span class="n">_value</span><span class="p">)</span> <span class="n">public</span> <span class="n">returns</span> <span class="p">(</span><span class="nb">bool</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">allowed</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">][</span><span class="n">_spender</span><span class="p">]</span> <span class="o">=</span> <span class="n">_value</span><span class="p">;</span>
    <span class="n">emit</span> <span class="n">Approval</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">_spender</span><span class="p">,</span> <span class="n">_value</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">function</span> <span class="n">allowance</span><span class="p">(</span><span class="n">address</span> <span class="n">_owner</span><span class="p">,</span> <span class="n">address</span> <span class="n">_spender</span><span class="p">)</span> <span class="n">public</span> <span class="n">constant</span> <span class="n">returns</span> <span class="p">(</span><span class="n">uint256</span> <span class="n">remaining</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">allowed</span><span class="p">[</span><span class="n">_owner</span><span class="p">][</span><span class="n">_spender</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can get this file directly from OpenZeppelin’s GitHub repo or copy
paste the code above and edit it as needed. Make sure to save your
contract to a local file on your computer (e.g. ERC721BasicToken.sol).
However, the code is only for demonstration only.</p>
</div>
</div>
<div class="section" id="compile-and-deploy-erc721-token-smart-contract">
<h1>Compile and deploy ERC721 token smart contract<a class="headerlink" href="#compile-and-deploy-erc721-token-smart-contract" title="Permalink to this headline">¶</a></h1>
<p>As a next step, you’ll need to generate the bytecode and ABI for your
new smart contract. You can think of the bytecode as basically your
contract’s compiled code. The ABI (Application Binary Interface) is a
JavaScript Object that defines how to interact with your smart contract.</p>
<p>We will show three ways of achieving this as well - using <a class="reference external" href="http://wallet.moac.io/">MOAC
wallet</a>, <a class="reference external" href="http://remix.ethereum.org/">Remix web IDE for Solidity
development</a>, or compiling using the solc
compiler on your machine (i.e. the command line).</p>
<div class="section" id="using-moac-wallet">
<h2>Using MOAC wallet<a class="headerlink" href="#using-moac-wallet" title="Permalink to this headline">¶</a></h2>
<p>MOAC wallet is an online free, client-side interface for using MOAC
wallets, make transactions and deploy contract. It was developed based
on open-source software. To use the service, you need to run a local
MOAC node with addition command line arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">rpccorsdomain</span> <span class="s2">&quot;http://wallet.moac.io&quot;</span>
</pre></div>
</div>
<p>This will allow the access of MOAC node using MOAC wallet.</p>
<p>Otherwise you will see the following error message:</p>
<div class="figure" id="id1">
<img alt="ERC20\_moacwallet01.png" src="_images/ERC20_moacwallet01.png" />
<p class="caption"><span class="caption-text">ERC20_moacwallet01.png</span></p>
</div>
<p>Example command to start a MOAC node connecting with mainnet:</p>
<p><code class="docutils literal notranslate"><span class="pre">moac</span> <span class="pre">--rpccorsdomain</span> <span class="pre">&quot;http://wallet.moac.io&quot;</span> <span class="pre">--rpc</span> <span class="pre">--rpcport</span> <span class="pre">&quot;8545&quot;</span> <span class="pre">--rpcapi</span> <span class="pre">&quot;chain3,mc,net,db&quot;</span></code></p>
<p>A successful interface connecting to mainnet looks like this:</p>
<div class="figure" id="id2">
<img alt="ERC20\_moacwallet02.png" src="_images/ERC20_moacwallet02.png" />
<p class="caption"><span class="caption-text">ERC20_moacwallet02.png</span></p>
</div>
<p>To compile the contract, click the “CONTRACTS” icon:</p>
<div class="figure" id="id3">
<img alt="ERC20\_moacwallet03.png" src="_images/ERC20_moacwallet03.png" />
<p class="caption"><span class="caption-text">ERC20_moacwallet03.png</span></p>
</div>
<p>Then enter the contract deploy page:</p>
<div class="figure" id="id4">
<img alt="ERC20\_moacwallet04.png" src="_images/ERC20_moacwallet04.png" />
<p class="caption"><span class="caption-text">ERC20_moacwallet04.png</span></p>
</div>
<p>Copy the source code and paste in the “SOLIDITY CONTRACT SOURCE CODE”
section. After copying the source code, the compiling process will
automatically started. If no errors are not found, the right side should
show a “SELECT CONTRACT TO DEPLOY” menu. <a href="#id12"><span class="problematic" id="id13">|ERC20\_moacwallet05.png|</span></a>
Select the contract name “TokenERC721”: <a href="#id14"><span class="problematic" id="id15">|ERC20\_moacwallet06.png|</span></a> Input
the parameters values from the menu:
<a href="#id16"><span class="problematic" id="id17">|ERC20\_moacwallet07.png|</span></a> You
need to have enough balance to deploy the contract. You can choose the
amount of fee to use when deploying the contract. Click the DEPLOY
button: <a href="#id18"><span class="problematic" id="id19">|ERC20\_moacwallet08.png|</span></a></p>
<p>This is the contract ready to send from Account 1. The Provide gas is
estimated by the compiler and we suggest you use it or put a larger
number. If gas is not enough, the contract cannot be created. To
continue, be sure to unlock the account to create the contract. You can
use a console attached to the MOAC to do this:</p>
<div class="figure" id="id5">
<img alt="ERC20\_moacwallet09.png" src="_images/ERC20_moacwallet09.png" />
<p class="caption"><span class="caption-text">ERC20_moacwallet09.png</span></p>
</div>
<p>After deploying, the interface is returned to the main menu and you can
see the following transaction is creating.</p>
<p><a href="#id20"><span class="problematic" id="id21">|ERC20\_moacwallet10.png|</span></a> After 12 confirmations, you can start using
the contract by click the admin page link. <a href="#id22"><span class="problematic" id="id23">|ERC20\_moacwallet11.png|</span></a></p>
<p>MOAC wallet is good for beginners that only need basic contract
development needs. It cannot debug contracts. To advanced developers,
you can use Remix to work with contracts.</p>
</div>
<div class="section" id="remix">
<h2>Remix<a class="headerlink" href="#remix" title="Permalink to this headline">¶</a></h2>
<p>Remix is an online tool developed by Ethereum community to work with
smart contracts. MOAC also supports the deploy of smart contract through
Remix.</p>
<p>Open Remix on your browser, create a new file called ‘TestToken.sol’ and
copy paste the code of your smart contract. Make sure you are including
all the other Solidity files that your code is referencing with imports,
especially if you are using the open source library approach.</p>
<p>Select ‘TestToken’ in the Compile window then click “Start to Compile”
and the Details button next to TestToken. Upon scrolling in the popup
details window for TestToken, you should be able to see similar sections
to this Remix screenshot for the bytecode and ABI of your smart
contract:</p>
<p>If the contract is compiled successfully, remix will show the interface
like this:</p>
<p><a href="#id24"><span class="problematic" id="id25">|ERC20\_moacwallet12.png|</span></a> To deploy the contract, you need to connect
REMIX to a local or remote MOAC node. In addition to other arguments, be
sure to enable the access of REMIX to the MOAC node with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">moac</span> <span class="o">--</span><span class="n">rpccorsdomain</span> <span class="s2">&quot;http://remix.ethereum.org&quot;</span> <span class="o">--</span><span class="n">rpc</span> <span class="o">--</span><span class="n">rpcport</span> <span class="s2">&quot;8545&quot;</span> <span class="o">--</span><span class="n">rpcapi</span> <span class="s2">&quot;chain3,mc,net,db&quot;</span>
</pre></div>
</div>
<p>Click the Run Tab and you should see the following menu:
<a href="#id26"><span class="problematic" id="id27">|ERC20\_moacwallet13.png|</span></a></p>
<p>Choose the Environment menu: JavaScript VM is a simulated environment of
Remix, it can be use to debugging the contract without actually
deploying the contract to a real network. Injected Web3 is the default
web3 connecting to Ethereum network. To deploy MOAC contract, you need
to choose Web3 Provider.</p>
<div class="figure" id="id6">
<img alt="ERC20\_moacwallet14.png" src="_images/ERC20_moacwallet14.png" />
<p class="caption"><span class="caption-text">ERC20_moacwallet14.png</span></p>
</div>
<p>After choose “Web3 Provider”, you can see a message like this:</p>
<p>Click “OK”,</p>
<div class="figure" id="id7">
<img alt="ERC20\_moacwallet15.png" src="_images/ERC20_moacwallet15.png" />
<p class="caption"><span class="caption-text">ERC20_moacwallet15.png</span></p>
</div>
<p>You need to make sure the port is the same as the local running node.</p>
<div class="figure" id="id8">
<img alt="ERC20\_moacwallet12.png" src="_images/ERC20_moacwallet16.png" />
<p class="caption"><span class="caption-text">ERC20_moacwallet12.png</span></p>
</div>
<p>You may see the error message like this:</p>
<p><a href="#id28"><span class="problematic" id="id29">|ERC20\_moacwallet17.png|</span></a> If you see this error message, check the local
node that include both</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">rpccorsdomain</span> <span class="s2">&quot;http://remix.ethereum.org&quot;</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">rpcport</span> <span class="s2">&quot;8545&quot;</span>
</pre></div>
</div>
<p>If the connection is established, you should see your accounts from the
Account List.</p>
<div class="figure" id="id9">
<img alt="ERC20\_moacwallet18.png" src="_images/ERC20_moacwallet18.png" />
<p class="caption"><span class="caption-text">ERC20_moacwallet18.png</span></p>
</div>
<p>Before you deploy the contract, you need to unlock the account that send
the contract. You can do the unlock with the MOAC console:</p>
<div class="figure" id="id10">
<img alt="ERC20\_moacwallet09.png" src="_images/ERC20_moacwallet09.png" />
<p class="caption"><span class="caption-text">ERC20_moacwallet09.png</span></p>
</div>
<p>After successfully deployed the contract, you should see the contract
address and other information showed in the menu:</p>
<div class="figure" id="id11">
<img alt="ERC20\_moacwallet19.png" src="_images/ERC20_moacwallet19.png" />
<p class="caption"><span class="caption-text">ERC20_moacwallet19.png</span></p>
</div>
<p>Remix is good for developing and debugging smart contracts. It is not
very convenient to deploy multiple contracts. If your requires to deploy
multiple contracts, you can use the Node.Js packages.</p>
</div>
<div class="section" id="using-the-node-js-packages">
<h2>Using the Node.Js packages<a class="headerlink" href="#using-the-node-js-packages" title="Permalink to this headline">¶</a></h2>
<p>You need to install solc package to compile the smart contract, and
chain3 package to deploy the contract.</p>
<p>To use the latest stable version of the Solidity compiler via Node.js
you can install it via npm:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">npm</span> <span class="n">install</span> <span class="n">solc</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">solc</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;solc&#39;</span><span class="p">)</span>
<span class="n">var</span> <span class="nb">input</span> <span class="o">=</span> <span class="s1">&#39;contract x { function g() </span><span class="si">{}</span><span class="s1"> }&#39;</span>
<span class="o">//</span> <span class="n">Setting</span> <span class="mi">1</span> <span class="k">as</span> <span class="n">second</span> <span class="n">paramateractivates</span> <span class="n">the</span> <span class="n">optimiser</span>
<span class="n">var</span> <span class="n">output</span> <span class="o">=</span> <span class="n">solc</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">var</span> <span class="n">contractName</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">contracts</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">code</span> <span class="ow">and</span> <span class="n">ABI</span> <span class="n">that</span> <span class="n">are</span> <span class="n">needed</span> <span class="n">by</span> <span class="n">web3</span>
        <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">contractName</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">contracts</span><span class="p">[</span><span class="n">contractName</span><span class="p">]</span><span class="o">.</span><span class="n">bytecode</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">contractName</span> <span class="o">+</span> <span class="s1">&#39;; &#39;</span> <span class="o">+</span> <span class="n">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">contracts</span><span class="p">[</span><span class="n">contractName</span><span class="p">]</span><span class="o">.</span><span class="n">interface</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To deploy the contracts, you need to install the Chain3 package:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">npm</span> <span class="n">install</span> <span class="n">chain3</span>
</pre></div>
</div>
<p>There is an example file in the package: example/contract_deploy.js</p>
<p>After successfully deploy, you should see the contract is displayed</p>
<p>Succeed!:
0x95d703ea48477f48335ae9c477ce6d986bc68453dfe3d6582714045456b93405</p>
<p>Using solc compiler to generate the ABI and bytecode Another way of
generating these two files is to compile your smart contract using the
solc compiler on your machine. If you haven’t used solc yet, you can
follow these instructions for installing it on your machine.</p>
<p>Open a Terminal window and navigate to your working directory where you
have saved your TestToken.sol file. Run the following command to export
the ‘TestToken.abi’ and ‘TestToken.bin’ files to the bin directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">solc</span> <span class="o">--</span><span class="nb">bin</span> <span class="o">--</span><span class="n">abi</span> <span class="o">-</span><span class="n">o</span> <span class="nb">bin</span> <span class="n">TestToken</span><span class="o">.</span><span class="n">sol</span>
</pre></div>
</div>
<p>As the file extensions suggest, ‘TestToken.abi’ contains your contract’s
ABI, and ‘TestToken.bin’ contains its bytecode.</p>
<p>If you prefer accessing the solc compiler from within a program’s code
to generate the ABI and bytecode files rather than using the command
line, you can use the following code instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">fs</span> <span class="o">=</span>  <span class="n">require</span> <span class="p">(</span> <span class="s1">&#39; fs &#39;</span> <span class="p">);</span>
<span class="n">var</span> <span class="n">solc</span> <span class="o">=</span>  <span class="n">requires</span> <span class="p">(</span> <span class="s1">&#39;solc&#39;</span> <span class="p">);</span>

<span class="n">var</span> <span class="n">cmds</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">argv</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="n">cmds</span> <span class="o">!=</span> <span class="n">null</span> <span class="o">&amp;&amp;</span> <span class="n">cmds</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">){</span>
  <span class="n">var</span> <span class="n">file</span> <span class="o">=</span> <span class="n">cmds</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
  <span class="n">var</span> <span class="n">name</span> <span class="o">=</span> <span class="n">cmds</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
  <span class="n">var</span> <span class="n">content</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">readFileSync</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">();</span>

  <span class="n">was</span> <span class="nb">input</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">content</span>
  <span class="p">};</span>

  <span class="n">var</span> <span class="n">output</span> <span class="o">=</span> <span class="n">solc</span><span class="o">.</span><span class="n">compile</span><span class="p">({</span><span class="n">sources</span><span class="p">:</span> <span class="nb">input</span><span class="p">},</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;contracts&#39;</span><span class="p">,</span> <span class="n">Object</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">contracts</span><span class="p">));</span>

  <span class="n">var</span> <span class="n">ctt</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">contracts</span><span class="p">[</span><span class="n">name</span><span class="p">];</span>
  <span class="k">if</span><span class="p">(</span><span class="n">ctt</span> <span class="o">==</span> <span class="n">null</span><span class="p">){</span>
      <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">var</span> <span class="n">bytecode</span> <span class="o">=</span> <span class="n">ctt</span><span class="o">.</span><span class="n">bytecode</span><span class="p">;</span>
  <span class="n">var</span> <span class="n">abi</span> <span class="o">=</span> <span class="n">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">ctt</span><span class="o">.</span><span class="n">interface</span><span class="p">);</span>

  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;bytecode&#39;</span><span class="p">,</span> <span class="n">bytecode</span><span class="p">);</span>
  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;abi&#39;</span><span class="p">,</span> <span class="n">ctt</span><span class="o">.</span><span class="n">interface</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Regardless of which method you followed, you should now have the ABI and
bytecode files for your TestToken smart contract. Next, you will be able
to deploy your token contract on the MOAC blockchain for others to
interact with it.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Creating your own ERC721 Token on MOAC blockchain</a></li>
<li><a class="reference internal" href="#write-the-erc721-token-smart-contract">Write the ERC721 token smart contract</a><ul>
<li><a class="reference internal" href="#using-a-ready-open-source-library">Using a ready open source library</a></li>
<li><a class="reference internal" href="#developing-your-smart-contract-directly">Developing your smart contract directly</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compile-and-deploy-erc721-token-smart-contract">Compile and deploy ERC721 token smart contract</a><ul>
<li><a class="reference internal" href="#using-moac-wallet">Using MOAC wallet</a></li>
<li><a class="reference internal" href="#remix">Remix</a></li>
<li><a class="reference internal" href="#using-the-node-js-packages">Using the Node.Js packages</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="ERC20.html" title="previous chapter">Creating your own ERC20 Token on the MOAC blockchain</a></li>
      <li>Next: <a href="FAQs.html" title="next chapter">Table of Contents</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/ERC721.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Wenhan Jin.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/ERC721.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>